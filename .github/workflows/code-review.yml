name: AI Code Review
on: 
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]  # Triggers on PR events
permissions:
  contents: read
  pull-requests: write  # Allows posting comments on PRs
jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4  # Checks out your repo code

      - name: AI Code Review
        uses: jonit-dev/openrouter-github-action@main  # The OpenRouter-integrated action
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}  # Auto-provided by GitHub for PR interactions
          open_router_key: ${{ secrets.OPENROUTER_API_KEY }}  # Your secret key
          # model: 'anthropic/claude-3.5-sonnet'  # Optional: Choose any OpenRouter model (e.g., 'openai/gpt-4o', 'google/gemini-pro'). Defaults to a cost-effective one if omitted.
          model: 'meta-llama/llama-3.1-8b-instruct:free'
          prompt: 'Review the code for bugs, performance issues, security vulnerabilities, and suggest improvements.'  # Optional: Customize the review prompt
          max_changed_files: 20  # Optional: Skip if PR has >20 changed files to avoid high costs
concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true